import{d as g,V as u,j as e,L as N,r as C}from"./index-BxtrJGGV.js";import{u as w,T as v,S}from"./useFilter-LKQwOntb.js";import{u as y}from"./index.esm-Ev2gQmM6.js";import{u as p}from"./useMutation-B4qgwQtS.js";import{A as F,E as D,d as A,u as k}from"./useGetCabins-Dw3lok6S.js";import{F as q}from"./Filter-C36inqW5.js";import{H as P}from"./Header-QfPSsCEn.js";function E(){const t=g(),{reset:a}=y(),{mutate:c,isPending:s}=p({mutationFn:F,onSuccess:()=>{u.success("Cabin added successfully"),t.invalidateQueries(["cabins"]),a()},onError:b=>{u.error(b.message||"Failed to add cabin")}});return{AddCabins:c,isAddLoading:s}}function L(){const t=g(),{mutate:a,isPending:c}=p({mutationFn:s=>D(s,s.id),onSuccess:()=>{u.success("Cabin updated successfully"),t.invalidateQueries(["cabins"])},onError:s=>{u.error(s.message||"Failed to update cabin")}});return{EditCabin:a,isEditLoading:c}}function O({setIsOpen:t,cabinToEdit:a}){const{AddCabins:c,isAddLoading:s}=E(),{EditCabin:b,isEditLoading:x}=L(),r=!!a,{register:o,handleSubmit:m,formState:{errors:n},reset:f}=y({defaultValues:a||{},image:void 0}),i=s||x;if(i)return e.jsx(N,{});const l=d=>{var j;const h=((j=d.image)==null?void 0:j[0])instanceof File?d.image[0]:r?a==null?void 0:a.image:"";r?b({...d,image:h,id:a.id}):c({...d,image:h}),t(!1)};return e.jsxs("form",{onSubmit:m(l),className:"bg-base-200 p-6 rounded-lg shadow-lg",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6 text-base-content text-center",children:r?"Edit Cabin":"Create New Cabin"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-base-content mb-2",children:"Cabin name"}),e.jsx("input",{type:"text",...o("Name",{required:"Cabin name is required"}),className:"w-full p-3 rounded-lg bg-base-100 border border-base-300 focus:outline-none focus:ring-2 focus:ring-primary",placeholder:"Enter cabin name"}),n.Name&&e.jsx("p",{className:"text-error text-sm mt-1",children:n.Name.message})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-base-content mb-2",children:"Maximum capacity"}),e.jsx("input",{type:"number",...o("maxCapacity",{required:"Maximum capacity is required",min:{value:1,message:"Capacity must be at least 1"}}),className:"w-full p-3 rounded-lg bg-base-100 border border-base-300 focus:outline-none focus:ring-2 focus:ring-primary",placeholder:"Enter maximum capacity"}),n.maxCapacity&&e.jsx("p",{className:"text-error text-sm mt-1",children:n.maxCapacity.message})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-base-content mb-2",children:"Regular price"}),e.jsx("input",{type:"number",...o("regularPrice",{required:"Regular price is required",min:{value:0,message:"Price cannot be negative"}}),className:"w-full p-3 rounded-lg bg-base-100 border border-base-300 focus:outline-none focus:ring-2 focus:ring-primary",placeholder:"Enter regular price"}),n.regularPrice&&e.jsx("p",{className:"text-error text-sm mt-1",children:n.regularPrice.message})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-base-content mb-2",children:"Discount"}),e.jsx("input",{type:"number",...o("discount",{required:"Discount is required",min:{value:0,message:"Discount cannot be negative"}}),className:"w-full p-3 rounded-lg bg-base-100 border border-base-300 focus:outline-none focus:ring-2 focus:ring-primary",placeholder:"Enter discount",defaultValue:0}),n.discount&&e.jsx("p",{className:"text-error text-sm mt-1",children:n.discount.message})]}),e.jsxs("div",{className:"mb-4 md:col-span-2",children:[e.jsx("label",{className:"block text-base-content mb-2",children:"Description for website"}),e.jsx("textarea",{...o("description",{required:"Description is required"}),className:"w-full p-3 rounded-lg bg-base-100 border border-base-300 focus:outline-none focus:ring-2 focus:ring-primary h-24 resize-none",placeholder:"Enter description"}),n.description&&e.jsx("p",{className:"text-error text-sm mt-1",children:n.description.message})]}),e.jsxs("div",{className:"mb-6 md:col-span-2",children:[e.jsx("label",{className:"block text-base-content mb-2",children:"Cabin image"}),r&&a.image&&e.jsx("img",{src:a.image,alt:"Current cabin",className:"w-24 h-24 mb-2 rounded-lg"}),e.jsx("input",{type:"file",...o("image"),className:"w-full p-3 rounded-lg bg-base-100 border border-base-300 focus:outline-none focus:ring-2 focus:ring-primary file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-primary file:text-primary-content hover:file:bg-primary-focus",accept:"image/*"}),e.jsx("p",{className:"text-base-content text-sm mt-1",children:r?"Upload a new image to replace the current one (optional)":"You should use an image to create the cabin"})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 mt-6 md:col-span-2",children:[e.jsx("button",{type:"button",className:"btn btn-neutral",onClick:()=>t(!1),disabled:i,children:"Cancel"}),e.jsx("button",{disabled:i,type:"submit",className:"btn btn-primary",children:i?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"loading loading-spinner loading-sm mr-2"}),r?"Updating...":"Adding..."]}):r?"Update Cabin":"Add Cabin"})]})]})}function Q(){const t=g(),{isPending:a,mutate:c}=p({mutationFn:s=>A(s),onSuccess:()=>{t.invalidateQueries(["cabins"]),u.success("Deleted Cabin")},onError:s=>{u.error("Delete failed: "+s.message)}});return{isDeleting:a,OnClickDeleteCabin:c}}function V(){const{cabins:t,isLoading:a}=k(),[c,s]=C.useState(!1),[b,x]=C.useState(),{isDeleting:r,OnClickDeleteCabin:o}=Q(),{sortedCabins:m}=w(t||[]),n=[{header:"Cabin",width:"w-1/6"},{header:"Name",width:"w-1/6"},{header:"Capacity",width:"w-1/6"},{header:"Price",width:"w-1/6"},{header:"Discount",width:"w-1/6"},{header:"Actions",width:"w-1/6"}],f=i=>{const l=m.find(d=>d.id===i);if(l){const d={id:l.id,description:l.description,discount:l.discount,regularPrice:l.regularPrice,maxCapacity:l.maxCapacity,Name:l.Name,image:l.image};x(d),s(!0)}};return e.jsxs(e.Fragment,{children:[a?e.jsx(N,{}):e.jsx(v,{columns:n,children:m==null?void 0:m.map(i=>e.jsxs("tr",{className:"hover:bg-base-300 transition-colors text-center",children:[e.jsx("td",{children:e.jsx("div",{className:"flex items-center gap-3",children:e.jsx("div",{className:"avatar mx-auto",children:e.jsx("div",{className:"mask mask-squircle size-12",children:e.jsx("img",{src:i.image,alt:i.Name})})})})}),e.jsx("td",{children:i.Name}),e.jsx("td",{children:i.maxCapacity}),e.jsx("td",{children:i.regularPrice}),e.jsxs("th",{children:["$",i.discount]}),e.jsx("th",{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn btn-error",onClick:()=>o(i.id),disabled:r,children:r?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"loading loading-spinner loading-sm mr-2"}),"Deleting..."]}):"Delete"}),e.jsx("button",{onClick:()=>f(i.id),className:"btn btn-primary",children:"Edit"})]})})]},i.id))}),e.jsx("button",{className:"btn btn-primary mt-4",onClick:()=>{x(null),s(!0)},children:"Add Cabin"}),c&&e.jsx("dialog",{open:!0,className:"modal modal-open",onClose:()=>s(!1),children:e.jsx("div",{className:"modal-box max-w-2xl bg-base-200 p-6 shadow-lg",children:e.jsx(O,{setIsOpen:s,cabinToEdit:b})})})]})}function M(){return e.jsxs(e.Fragment,{children:[e.jsx(q,{filterField:"Discount",options:[{value:"All",label:"All"},{value:"No-discount",label:"No-discount"},{value:"With-discount",label:"With-discount"}]}),e.jsx(S,{filterField:"SortBy",options:[{value:"name-asc",label:"Sort by name (A-Z)"},{value:"name-disc",label:"Sort by name (Z-A)"},{value:"regularPrice-asc",label:"Sort by price (low frist)"},{value:"regularPrice-disc",label:"Sort by price (high frist)"},{value:"maxCapacity-asc",label:"Sort by capacity (low frist)"},{value:"maxCapacity-disc",label:"Sort by capacity (high frist)"}]})]})}function G(){return e.jsxs(e.Fragment,{children:[e.jsxs("header",{className:"flex flex-col md:flex-row justify-between items-center gap-2 w-full",children:[e.jsx(P,{className:"w-full md:w-1/3 lg:w-1/4",children:"Cabins"}),e.jsx("ul",{className:"flex w-full md:w-2/3 lg:w-3/4 items-center gap-2",children:e.jsx(M,{})})]}),e.jsx(V,{})]})}export{G as default};
