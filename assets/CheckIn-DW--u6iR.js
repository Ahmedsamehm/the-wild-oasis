import{d as N,b as P,V as g,r as y,j as e,L as o,g as O}from"./index-BxtrJGGV.js";import{B as $,u as E}from"./useGetSpecificBook-DkC0jGfL.js";import{u as I}from"./useMutation-B4qgwQtS.js";import{a as L,u as q}from"./useBooking-XrgYWRRI.js";import{u as B}from"./useDeleteBook-DqecA2Dh.js";import{a as G}from"./useGetSetting-DKRJf8C4.js";function Q(){const s=N(),t=P(),{mutate:a,isPending:c,error:n}=I({mutationFn:({idBooking:r,breakfast:u})=>L(r,{status:"checked-in",isPaid:!0,...u}),onSuccess:()=>{g.success("Checked in successfully"),s.invalidateQueries({queryKey:["bookings"]}),t("/Booking")},onError(r){g.error(r.message)}});return{checkInFunc:a,isCheckLoading:c,error:n}}function A(){const s=N(),{mutate:t,isPending:a,error:c}=I({mutationFn:n=>L(n,{status:"checked-out"}),onSuccess:()=>{g.success("Checked out successfully"),s.invalidateQueries({queryKey:["bookings"]})},onError(n){g.error(n.message)}});return{CheckOutFunc:t,CheckOutLoading:a,CheckOutErr:c}}function K(s,t,a){const[c,n]=y.useState(!1),[r,u]=y.useState(!1),{checkInFunc:i,isCheckLoading:m}=Q(),{CheckOutFunc:h,CheckOutLoading:f}=A(),{numNights:C,numGuests:k,totalPrice:x}=s||{},l=a==null?void 0:a.find(D=>D.id===1),d=(l?l.breakfastPrice:0)*C*k,b=()=>{n(!c)},j=()=>{u(!r)},v={hasBreakfast:!0,extrasPrice:d,totalPrice:x+d};return{payConfirm:c,breakfastConfirm:r,isCheckLoading:m,CheckOutLoading:f,totalBreakfast:d,handlePay:b,handleBreakfast:j,handleCheckIn:()=>{r&&i({idBooking:t,breakfast:v})},handleCheckOut:()=>{h(t)}}}function S({BookFound:s,Status:t,idBooking:a,Setting:c,isLoading:n}){const r=P(),{guestID:u,id:i}=s||{},{DeleteBook:m,DeleteLoading:h}=B(),{payConfirm:f,breakfastConfirm:C,isCheckLoading:k,CheckOutLoading:x,totalBreakfast:l,handlePay:p,handleBreakfast:d,handleCheckIn:b,handleCheckOut:j}=K(s,a,c);return e.jsx(e.Fragment,{children:n?e.jsx(o,{}):e.jsxs(e.Fragment,{children:[e.jsx($,{BookFound:s,isLoading:n}),t==="unconfirmed"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-5 bg-neutral mt-4 rounded-xl",children:e.jsxs("div",{children:[e.jsx("input",{type:"checkbox",onChange:d,className:"checkbox"}),e.jsxs("span",{children:["Want to add breakfast for $",l||"N/A"]})]})}),e.jsx("div",{className:"p-5 bg-neutral mt-4 rounded-xl",children:e.jsxs("div",{children:[e.jsx("input",{type:"checkbox",onChange:p,disabled:f,className:"checkbox"}),e.jsxs("span",{children:["I confirm that ",u," has paid the total amount of $",s==null?void 0:s.totalPrice]}),C?e.jsxs("span",{children:["(",s==null?void 0:s.totalPrice,"+",l,") = $",(s==null?void 0:s.totalPrice)+l]}):""]})})]}):null,e.jsxs("div",{className:"flex justify-end mt-3 gap-2",children:[t==="checked-out"&&e.jsx("button",{disabled:h,onClick:()=>{m(i)},className:"btn btn-error ",children:h?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(o,{})," Deleting..."]}):`Delete ${i}`}),t==="unconfirmed"&&e.jsx(e.Fragment,{children:e.jsx("button",{onClick:b,className:"btn btn-primary",disabled:!f||k,children:k?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(o,{})," Loading..."]}):`Check-in ${i}`})}),t==="checked-in"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:j,className:"btn btn-primary",disabled:x,children:x?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(o,{})," Loading..."]}):`Check-out ${i}`}),e.jsx("button",{onClick:()=>{m(i)},className:"btn btn-error",children:h?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(o,{})," Deleting..."]}):`Delete ${i}`})]}),e.jsx("button",{onClick:()=>r("/Booking"),className:"btn btn-neutral",children:"Back"})]})]})})}function T(){const{Bookings:s,isLoading:t}=q(),{Setting:a}=G(),{idBooking:c}=O(),{specificBooking:n,status:r}=E(s,c);return t||!n?e.jsx(o,{}):e.jsx(e.Fragment,{children:e.jsx(S,{Status:r,isLoading:t,BookFound:n,idBooking:c,Setting:a})})}export{T as default};
